plugins {
    id 'java'
}

group 'net.insprill'
version "${gradle.ext.version}${getVersionMetadata()}"

build {
    enabled = false
    dependsOn(":dist:shadowJar")
}

jar {
    enabled = false
}

allprojects {
    group "${gradle.rootProject.group}"
    version "${gradle.rootProject.version}"

    compileJava.options.encoding = 'UTF-8'

    repositories {
        mavenCentral()
        mavenLocal()
        maven { url = 'https://jitpack.io' }
        maven { url = 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/' }
    }
}

def getVersionMetadata() {
    if (gradle.ext.version.contains('-SNAPSHOT')) {
        return '+rev.' + 'git rev-parse --verify --short HEAD'.execute().text.trim()
    } else {
        return ''
    }
}
